package amazon;
import java.io.IOException;

import org.jsoup.Connection;
import org.jsoup.Jsoup;
import org.jsoup.nodes.Document;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

public class scraper {
	
	final static String BASE = "https://www.amazon.com/s/ref=lp_172659_st?rh=n%3A172282%2Cn%3A%21493964%2Cn%3A1266092011%2Cn%3A172659&qid=1520461163&sort=review-rank";
	final static String prefix = "https://www.amazon.com/s/ref=sr_pg_2?rh=n%3A172282%2Cn%3A%21493964%2Cn%3A1266092011%2Cn%3A172659&page=";
	final static String postfix = "&sort=review-rank&ie=UTF8&qid=1520474376";
	
	public static void main(String[] args) {
		int index = 0;
		index = scrape(index ,BASE);
		for (int i = 2; i <= 42; i++) {
			index = scrape(index ,prefix + i + postfix);
		}
		
		
	
	}
	
	private static int scrape(int index, String url) {
		Connection.Response response = null;
		
		System.out.println(index + url);
		
		try {
			response = Jsoup.connect(url).followRedirects(true).execute();
		} catch (IOException e) {
			//connection failed
			e.printStackTrace();
		}
		
		if (response != null && response.statusCode() == 200) {
			
			Document doc = null;
			
			try {
				doc = response.parse();
			}
			catch (Exception e) {
				e.printStackTrace();
			}
			
			Elements result = null;
			for (int i = index+1; i <= index + 24; i++) {
				result = doc.select("#result_" + i);
				
				System.out.println(i);
				Item item = new Item(1, result.first());
			}

		}
		
		return index + 24;
		
	}

}
